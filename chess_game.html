<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chess</title>
<style>
  body { font-family: Arial; text-align: center; background: #111; color: #fff; }
  table { border-collapse: collapse; margin: 20px auto; }
  td { width: 60px; height: 60px; text-align: center; vertical-align: middle; font-size: 36px; cursor: pointer; }
  .white { background: #eee; color: #000; }
  .black { background: #555; color: #fff; }
  #msg { margin: 10px; font-size: 18px; height: 24px; }
  button { font-size: 16px; padding: 6px 12px; margin: 5px; cursor: pointer; }
</style>
</head>
<body>
<h1>Chess</h1>
<div>
  Difficulty:
  <select id="difficulty">
    <option value="easy">Easy</option>
    <option value="hard">Hard</option>
  </select>
  <button onclick="startGame()">Start Game</button>
  <button onclick="location.href='games_hub_site.html'">Home</button>
</div>
<div id="msg"></div>
<table id="chessBoard"></table>

<script>
const boardElement = document.getElementById("chessBoard");
let board = [];
let selected = null;
let currentPlayer = "white";
let difficulty = "easy";

const pieces = {
  'r': '♜', 'n': '♞', 'b': '♝', 'q': '♛', 'k': '♚', 'p': '♟',
  'R': '♖', 'N': '♘', 'B': '♗', 'Q': '♕', 'K': '♔', 'P': '♙'
};

function startGame() {
  difficulty = document.getElementById("difficulty").value;
  initBoard();
  renderBoard();
  document.getElementById("msg").innerText = "";
  selected = null;
  currentPlayer = "white";
}

function initBoard() {
  board = [
    ['r','n','b','q','k','b','n','r'],
    ['p','p','p','p','p','p','p','p'],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['','','','','','','',''],
    ['P','P','P','P','P','P','P','P'],
    ['R','N','B','Q','K','B','N','R']
  ];
}

function renderBoard() {
  boardElement.innerHTML = '';
  for(let i=0;i<8;i++){
    let row = document.createElement("tr");
    for(let j=0;j<8;j++){
      let cell = document.createElement("td");
      cell.className = (i+j)%2===0 ? 'white' : 'black';
      cell.innerText = pieces[board[i][j]] || '';
      cell.dataset.row = i;
      cell.dataset.col = j;
      cell.onclick = handleClick;
      row.appendChild(cell);
    }
    boardElement.appendChild(row);
  }
}

function handleClick() {
  const row = parseInt(this.dataset.row);
  const col = parseInt(this.dataset.col);
  const piece = board[row][col];

  if(selected){
    // Attempt move
    if(isValidMove(selected.row, selected.col, row, col)){
      board[row][col] = board[selected.row][selected.col];
      board[selected.row][selected.col] = '';
      selected = null;
      currentPlayer = currentPlayer === "white" ? "black" : "white";
      renderBoard();
      if(currentPlayer === "black") aiMove();
    } else {
      document.getElementById("msg").innerText = "Invalid move!";
    }
  } else {
    // Select piece
    if(piece && isWhitePiece(piece) === (currentPlayer === "white")){
      selected = {row, col};
      document.getElementById("msg").innerText = "";
    } else {
      document.getElementById("msg").innerText = "Select your own piece!";
    }
  }
}

function isWhitePiece(p) { return p && p === p.toUpperCase(); }

function isValidMove(r1,c1,r2,c2){
  // Basic check: can't capture own piece
  const from = board[r1][c1];
  const to = board[r2][c2];
  if(!from) return false;
  if(to && isWhitePiece(to) === isWhitePiece(from)) return false;
  // For simplicity, allow pawn move 1 forward or capture diagonal, rook horizontal/vertical 1 step, knight L-shape, king 1 step, bishop diagonal 1 step, queen 1 step
  const dr = r2-r1, dc = c2-c1;
  const f = from.toLowerCase();
  if(f==='p'){
    const dir = isWhitePiece(from) ? -1 : 1;
    if(dc===0 && dr===dir && !to) return true;
    if(Math.abs(dc)===1 && dr===dir && to) return true;
  } else if(f==='r') return (Math.abs(dr)===1 && dc===0) || (Math.abs(dc)===1 && dr===0);
  else if(f==='n') return (Math.abs(dr)===2 && Math.abs(dc)===1) || (Math.abs(dr)===1 && Math.abs(dc)===2);
  else if(f==='b') return Math.abs(dr)===1 && Math.abs(dc)===1;
  else if(f==='q') return Math.abs(dr)<=1 && Math.abs(dc)<=1;
  else if(f==='k') return Math.abs(dr)<=1 && Math.abs(dc)<=1;
  return false;
}

function aiMove(){
  setTimeout(()=>{
    // Easy: random move
    let moves = [];
    for(let i=0;i<8;i++){
      for(let j=0;j<8;j++){
        const p = board[i][j];
        if(p && !isWhitePiece(p)){
          for(let r=0;r<8;r++){
            for(let c=0;c<8;c++){
              if(isValidMove(i,j,r,c)) moves.push({from:[i,j],to:[r,c]});
            }
          }
        }
      }
    }
    if(moves.length===0){
      document.getElementById("msg").innerText = "Game Over!";
      return;
    }
    let move;
    if(difficulty==='easy'){
      move = moves[Math.floor(Math.random()*moves.length)];
    } else {
      // Hard: pick move that captures piece if possible
      let captureMoves = moves.filter(m=>{
        const [r,c] = m.to;
        return board[r][c];
      });
      move = captureMoves.length ? captureMoves[Math.floor(Math.random()*captureMoves.length)] : moves[Math.floor(Math.random()*moves.length)];
    }
    const [fr,fc] = move.from;
    const [tr,tc] = move.to;
    board[tr][tc] = board[fr][fc];
    board[fr][fc] = '';
    currentPlayer = "white";
    renderBoard();
  }, 500);
}

startGame();
</script>
</body>
</html>
